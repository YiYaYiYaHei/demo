<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3d地球+2d散点+2d地图</title>
    <script src="../js/echarts-4.2.0.js"></script>
    <script src="../js/echarts-gl-1.1.1-.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="../js/echarts-world.js"></script>
    <style>
        html {
            height: 100%;
        }
        body {
            height: 100%;
            background:url('../img/003.jpg');
            background-size: cover;
        }
    </style>
</head>
<body>
<div id="container" style="height:100%;box-sizing: border-box;"></div>

<script>
    // 城市、国家 地理坐标
    const geoCoordMap = {
        '南宁': [108.479, 23.1152],
        '广州': [113.5107, 23.2196],
        '重庆': [107.7539, 30.1904],
        '芬兰': [24.909912, 60.169095],
        '美国': [-100.696295, 33.679979],
        '日本': [139.710164, 35.706962],
        '韩国': [126.979208, 37.53875],
        '瑞士': [7.445147, 46.956241],
        '东南亚': [117.53244, 5.300343],
        '澳大利亚': [135.193845, -25.304039],
        '德国': [13.402393, 52.518569],
        '英国': [-0.126608, 51.208425],
        '加拿大': [-102.646409, 59.994255]
    };

    // 连线起始位置
    var CQData = [
        [{name: '重庆'}, {name: "英国",value: 70}]
    ];

    var GZData = [
        [{name: '广州'}, {name: "日本",value: 30}],
    ];

    var NNData = [
        [{name: '南宁'}, {name: "加拿大",value: 80}],
        [{name: '南宁'}, {name: "美国",value: 100}],
        [{name: '南宁'}, {name: "澳大利亚",value: 95}],
        [{name: '南宁'}, {name: "瑞士",value: 50}]
    ];

    // 根据起始位置，获得线的地理位置
    function convertData(data) {

        let res = [];
        for(let i = 0; i < data.length; i++) {

            let dataItem = data[i];
            let [fromCoord, toCoord] = [geoCoordMap[dataItem[1].name], geoCoordMap[dataItem[0].name]];

            if (fromCoord && toCoord) res.push([fromCoord, toCoord]);
        }
        return res;
    }

    let series = []; // 3D飞线
    let dser = []; // 2D散点坐标
    [['重庆', CQData],['广州', GZData],['南宁', NNData]].forEach(function(item, i) {

        dser.push({
            type: 'effectScatter',
            coordinateSystem: 'geo',
            zlevel: 3,
            rippleEffect: {
                brushType: 'stroke'
            },
            label: {
                fontSize:24,
                show: true,
                position: 'right',
                formatter: '{b}'
            },
            itemStyle: {
                normal: {
                    color: '#f5f802'
                }
            },
            data: item[1].map(function(dataItem) {

                return {
                    name: dataItem[1].name,
                    value: geoCoordMap[dataItem[1].name],
                    symbolSize: dataItem[1].value / 4
                };
            })
        },{
            type: 'effectScatter',
            coordinateSystem: 'geo',
            zlevel: 3,
            rippleEffect: {
                brushType: 'stroke'
            },
            label: {
                normal: {
                    show: true,
                    position: 'left',
                    fontSize:18,
                    formatter: '{b}'
                }
            },
            itemStyle: {
                normal: {
                    color: '#ff0000'
                }
            },
            data: [{
                name: item[0],
                value: geoCoordMap[item[0]],
                symbolSize:parseInt(Math.random()*20+10),
                label: {
                    normal: {
                        position: 'right'
                    }
                }
            }]
        });

        series.push({
            type: 'lines3D',
            effect: {
                show: true,
                period: 3,//速度
                trailLength: 0.1//尾部阴影
            },
            lineStyle: {//航线的视图效果
                color: '#9ae5fc',
                width: 1,
                opacity: 0.6
            },
            tooltip: {
                show: true,
                trigger: 'item',
                formatter(item) {

                    console.log(3);
                    return 20;
                }
            },
            data: convertData(item[1]) // 特效的起始、终点位置，一个二维数组，相当于coords: convertData(item[1])
        })
    });

    let canvas = document.createElement('canvas');
    let myChart = echarts.init(canvas, null, {
        width: 4096,
        height: 2048
    });

    // 添加2d散点图
    myChart.setOption({
        backgroundColor: 'rgba(3,28,72,0.3)',
        tooltip: {
            show: true,
            alwaysShowContent: true,
            formatter(item) {

                console.log(item);
                return item.name;
            }
        },
        geo: {
            type: 'map',
            map: 'world',
            left:0,
            top:0,
            right: 0,
            bottom: 0,
            boundingCoords: [[-180, 90], [180, -90]],
            zoom:0,
            roam: false,
            itemStyle: {
                borderColor:'#000d2d',
                normal: {
                    areaColor: '#2455ad',
                    borderColor:'#000c2d'
                },
                emphasis: {
                    areaColor: '#357cf8'
                }
            },
            label:{
                fontSize:24
            }
        },
        series:dser
    });

    // 添加地球
    let option = {
        backgroundColor: 'rgba(0,0,0,0)', // canvas的背景颜色
        tooltip: {
            show: true,
            alwaysShowContent: true,
            formatter(item) {

                console.log(1);
                return item.name;
            }
        },
        globe: {
            baseTexture: myChart,
            top: 'middle',
            left: 'center',
            displacementScale: 0,
            environment: 'none',
            shading: 'color',
            viewControl: {
                distance: 240,
                autoRotate: false // true
            }
        },
        roam: true,
        series: series
    };

    echarts.init(document.getElementById("container")).setOption(option, true);
</script>
</body>
</html>